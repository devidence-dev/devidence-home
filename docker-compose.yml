services:
  app:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: devidence-home
    restart: unless-stopped
    # Resource limits using deploy (recommended for production)
    deploy:
      resources:
        limits:
          cpus: "0.5"
          memory: 128M
    # Security settings
    security_opt:
      - no-new-privileges:true
    # Add more security with seccomp
    # Uncomment when you have a seccomp profile ready
    # security_opt:
    #   - seccomp:seccomp-profile.json
    # Drop capabilities
    cap_drop:
      - ALL
    # Add only necessary capabilities
    cap_add:
      - NET_BIND_SERVICE
      - CHOWN
      - SETGID
      - SETUID
    # Read-only root filesystem
    read_only: true
    # Mount temporary filesystem for writable directories
    tmpfs:
      - /tmp:exec,mode=1777
      - /var/run:exec,mode=1777
      - /run:exec,mode=1777
      - /var/cache/nginx/client_temp:exec,mode=755,uid=101,gid=101
      - /var/cache/nginx/proxy_temp:exec,mode=755,uid=101,gid=101
      - /var/cache/nginx/fastcgi_temp:exec,mode=755,uid=101,gid=101
      - /var/cache/nginx/uwsgi_temp:exec,mode=755,uid=101,gid=101
      - /var/cache/nginx/scgi_temp:exec,mode=755,uid=101,gid=101
    # Run as nginx user (non-privileged, UID 101)
    user: "101:101"
    # Logging configuration
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"
    